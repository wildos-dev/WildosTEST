import{j as e,r as v}from"./react-core-Bcdk_OeX.js";import{ap as F,aq as $,p as R,P as Z,o as J,j as h,q as U,ar as W,n as X,u as B,as as Y,at as ee,au as se,av as te,aw as ae,ax as ie,h as ne,ay as re,az as le,aA as oe,aB as de,aC as ce,aD as me,aE as xe,aF as ue,aG as he,aH as je,I as p,aI as pe,aJ as ge,aK as be,aL as A,aM as fe,aN as ve,aO as ye,aP as Ne,B as u,aQ as Ce,A as g,aR as Se,aS as Te,aT as we,aU as ke,aV as Ee,aW as Pe,aX as ze,ak as Ie,aY as De,a0 as Ae,aZ as He,Z as Fe}from"./index-D9xJNTt9.js";import"./layout-Y81SaLgb.js";import{d as b,aK as n}from"./react-ecosystem-DA9e0y3F.js";import"./dnd-kit-BufO2FBr.js";import{u as $e,h as Re,O as Be}from"./router-BzWBhOx2.js";import{P as Ve}from"./index-d4rf_bwY.js";import{u as Oe}from"./query-BGTG4bZD.js";import{S as qe}from"./index-BqxW2es5.js";import"./monaco-D6sUsa5W.js";import"./styling-utils--BulIq_u.js";import"./network-3TAtD9nM.js";import"./forms-D7oth6Cp.js";import"./search-CgVhiaN-.js";import"./state-BNTuQEE6.js";import"./date-utils-hmeNWewA.js";import"./table-DQ5QIWK1.js";import"./recharts-CPh6Hnhc.js";const Ke=({header:s,content:t,entity:a,checked:i=!1})=>e.jsx(F,{className:"w-full h-30 m-[4px]",children:e.jsxs($,{className:R("p-2 flex-col flex gap-2 justify-start",i&&"dark:bg-primary-foreground bg-secondary"),children:[e.jsx(s,{entity:a}),e.jsx(t,{entity:a})]})}),Le=({buttonChild:s})=>e.jsxs(Z,{children:[e.jsx(J,{asChild:!0,children:e.jsx(h,{size:"sm",variant:"outline",className:"mr-1 lg:flex",children:s})}),e.jsx(U,{className:"w-80 p-0",children:e.jsx(V,{})})]}),V=()=>{const s=W(),t=X();if(!s||!t)return null;const{sidebarEntityId:a,sidebarEntities:i,setSidebarEntityId:l,sidebarCardProps:d}=s,{table:r}=t,c=B("md"),j=r.getState().pagination.pageSize<=10&&c?"max-h-[45rem]":"max-h-[20rem]",{t:m}=b();return e.jsxs(Y,{className:"w-full",children:[e.jsx(ee,{children:e.jsx(se,{children:e.jsxs(te,{className:"hstack justify-between items-center",children:[m("inbounds"),e.jsx(h,{variant:"ghost",size:"sm",className:"p-1",onMouseDown:()=>l(void 0),children:m("deselect")})]})})}),e.jsx(ae,{children:e.jsx(ie,{type:"single",onValueChange:o=>l(o===""?void 0:o),defaultValue:a?String(a):void 0,children:e.jsx(ne,{className:R("flex flex-col justify-start p-1 gap-3 h-full w-full",j),children:i.map(o=>e.jsx(re,{className:"px-0 w-full h-30",value:String(o.id),id:String(o.id),children:e.jsx(Ke,{...d||{},entity:o,checked:a===String(o.id)})},String(o.id)))})})})]})},Me=({fetchEntity:s,columnsFn:t,filteredColumn:a,rowSelection:i,entityKey:l,onCreate:d,onEdit:r,onOpen:c,onDelete:j,sidebarEntityId:m,setSidebarEntityId:o,sidebarEntities:x,sidebarCardProps:T,secondaryEntityKey:O})=>{const{t:q}=b(),y=le({column:a}),N=oe(),f=de(),K=ce(),L=B("md"),{onPaginationChange:M,pageIndex:w,pageSize:k}=me({entityKey:l}),G=[l,m,O,{page:w,size:k},y.columnFilters,{sortBy:f.sorting[0]?.id?f.sorting[0].id:"created_at",desc:f.sorting[0]?.desc},{filters:N.columnsFilter}],{data:C,isFetching:E,error:P,isError:z,refetch:I}=Oe({queryFn:s,queryKey:G,initialData:{entities:[],pageCount:0}}),D=t({onEdit:r,onDelete:j,onOpen:c}),S=xe({data:C,columns:D,pageSize:k,pageIndex:w,rowSelection:i,visibility:K,sorting:f,onPaginationChange:M}),_=v.useMemo(()=>({entityKey:l,table:S,data:C.entities,primaryFilter:y,filters:N,isLoading:E,error:P,isError:z,refetch:I}),[l,S,C.entities,N,y,E,P,z,I]),Q=v.useMemo(()=>({sidebarEntities:x,setSidebarEntityId:o,sidebarEntityId:m,sidebarCardProps:T}),[x,o,m,T]);return{t:q,desktop:L,table:S,entityTableContextValue:_,sidebarEntityTableContextValue:Q,columns:D,onCreate:d}};function H({table:s,columns:t,props:a}){return e.jsxs("div",{className:"flex flex-col justify-between size-full",children:[e.jsx(ve,{columns:t,onRowClick:a.onOpen,CardComponent:a.CardComponent,cardActions:a.cardActions}),e.jsx(ye,{table:s})]})}function Ge(s){const{t}=b(),{desktop:a,table:i,entityTableContextValue:l,sidebarEntityTableContextValue:d,columns:r,onCreate:c}=Me(s);return e.jsx(ue.Provider,{value:l,children:e.jsx(he.Provider,{value:d,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-col md:flex-row-reverse items-center py-4 gap-2 w-full",children:[e.jsxs("div",{className:"flex flex-row justify-center items-center w-full",children:[!a&&e.jsx(Le,{buttonChild:e.jsxs(je,{className:"items-center p-1",children:[e.jsx(p,{name:"Server",className:"size-4"})," ",t("inbounds")]})}),e.jsx(pe,{table:i}),c&&e.jsx(h,{"aria-label":`create-${s.entityKey}`,onClick:c,children:t("create")})]}),e.jsx(ge,{})]}),e.jsx("div",{className:"w-full rounded-md border",children:a?e.jsxs(be,{direction:"horizontal",children:[e.jsx(A,{minSize:20,maxSize:40,children:e.jsx(V,{})}),e.jsx(fe,{withHandle:a}),e.jsx(A,{children:e.jsx(H,{table:i,columns:r,props:s})})]}):e.jsx(H,{table:i,columns:r,props:s})})]})})})}const _e=({entity:s,actions:t,onRowClick:a})=>{const i=()=>{a?.(s)},l=r=>{r.stopPropagation()},d=!s.is_disabled;return e.jsxs(F,{className:"w-full cursor-pointer hover:bg-muted/50 transition-colors",onClick:i,"data-testid":`card-host-${s.id}`,children:[e.jsx(Ne,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:e.jsx("span",{className:"font-medium truncate","data-testid":`text-remark-${s.id}`,children:s.remark})}),e.jsx(u,{variant:d?"default":"secondary",className:"text-xs","data-testid":`status-host-${s.id}`,children:d?n.t("active"):n.t("disabled")})]})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:n.t("address")}),e.jsxs("div",{className:"text-sm","data-testid":`text-address-${s.id}`,children:[s.address,":",s.port]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:n.t("type")}),e.jsx(u,{variant:"outline",className:"text-xs",children:"TCP"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:n.t("inbound")}),e.jsx(u,{variant:"secondary",className:"text-xs",children:n.t("inbound")})]})]})]}),e.jsx(Ce,{className:"pt-2",onClick:l,children:e.jsxs("div",{className:"flex gap-2 w-full justify-end",children:[e.jsx(h,{variant:"secondary",size:"touch-sm",onClick:r=>{r.stopPropagation(),t.onEdit?.(s)},className:"min-w-11 size-11",title:n.t("edit"),"data-testid":`button-edit-${s.id}`,children:e.jsx(p,{name:"Edit",className:"h-5 w-5"})}),e.jsx(h,{variant:"destructive",size:"touch-sm",onClick:r=>{r.stopPropagation(),t.onDelete?.(s)},className:"min-w-11 size-11",title:n.t("delete"),"data-testid":`button-delete-${s.id}`,children:e.jsx(p,{name:"Trash2",className:"h-5 w-5"})})]})})]})},Qe=s=>[{accessorKey:"remark",header:({column:t})=>e.jsx(g,{title:n.t("name"),column:t}),cell:({row:t})=>{const a=t.original;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-medium truncate",children:a.remark})})}},{accessorKey:"address",header:({column:t})=>e.jsx(g,{title:n.t("address"),column:t}),cell:({row:t})=>{const a=t.original;return e.jsxs("div",{className:"hidden lg:block text-sm text-muted-foreground truncate",children:[a.address,":",a.port]})}},{id:"type",header:({column:t})=>e.jsx(g,{title:n.t("type"),column:t}),cell:()=>e.jsx("div",{className:"hidden md:block",children:e.jsx(u,{variant:"outline",className:"text-xs",children:"TCP"})})},{id:"inbound",header:({column:t})=>e.jsx(g,{title:n.t("inbound"),column:t}),cell:()=>e.jsx("div",{className:"hidden sm:block",children:e.jsx(u,{variant:"secondary",className:"text-xs",children:n.t("inbound")})})},{id:"status",header:({column:t})=>e.jsx(g,{title:n.t("status"),column:t}),cell:({row:t})=>{const i=!t.original.is_disabled;return e.jsx(u,{variant:i?"default":"secondary",className:"text-xs",children:i?n.t("active"):n.t("disabled")})}},{id:"actions",cell:({row:t})=>e.jsx("div",{className:"relative group",children:e.jsxs("div",{className:"absolute top-2 right-2 sm:top-3 sm:right-3 flex gap-1 sm:gap-2 opacity-100 sm:opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity z-20",children:[e.jsx(h,{variant:"secondary",size:"touch-sm",onClick:a=>{a.stopPropagation(),s.onEdit?.(t.original)},className:"focus-visible:opacity-100 shadow-lg",title:n.t("edit"),children:e.jsx(p,{name:"Edit",className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx(h,{variant:"destructive",size:"touch-sm",onClick:a=>{a.stopPropagation(),s.onDelete?.(t.original)},className:"focus-visible:opacity-100 shadow-lg",title:n.t("delete"),children:e.jsx(p,{name:"Trash2",className:"h-4 w-4 sm:h-5 sm:w-5"})})]})})}],Ze=({open:s,onOpenChange:t})=>{const{t:a}=b();return e.jsx(Se,{open:s,onOpenChange:t,children:e.jsxs(Te,{children:[e.jsxs(we,{children:[e.jsx(ke,{children:a("page.hosts.no-inbound-selection-alert.title")}),e.jsx(Ee,{children:a("page.hosts.no-inbound-selection-alert.desc")})]}),e.jsx(Pe,{children:e.jsx(ze,{children:a("close")})})]})})},Je=({entity:s})=>e.jsx("div",{className:"flex items-center",children:e.jsx(Ie,{className:"font-bold capitalize",children:s.tag})}),Ue=({entity:s})=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"hstack items-center",children:[e.jsx(p,{name:"Box",className:"p-1"})," ",s.node.name]}),e.jsx(u,{children:s.protocol})]}),We=()=>{const{data:s}=De({page:1,size:100}),[t,a]=v.useState(s?.entities?.[0]?.id!==void 0?String(s?.entities?.[0]?.id):void 0),i=$e({from:"/hosts"}),[l,d]=Ae(),r=x=>i({to:"/hosts/$hostId/edit",params:{hostId:String(x.id)}}),c=x=>i({to:"/hosts/$hostId/delete",params:{hostId:String(x.id)}}),j=x=>i({to:"/hosts/$hostId",params:{hostId:String(x.id)}}),m={onEdit:r,onDelete:c,onOpen:j},o=()=>{t?i({to:"/hosts/$inboundId/create",params:{inboundId:t}}):d(!0)};return e.jsxs("div",{className:"w-full space-y-4 sm:space-y-6",children:[e.jsx(Ze,{open:l,onOpenChange:d}),e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsx(Ge,{fetchEntity:He,entityKey:"inbounds",secondaryEntityKey:"hosts",sidebarEntities:s?.entities||[],sidebarEntityId:t,columnsFn:Qe,filteredColumn:"remark",setSidebarEntityId:a,onCreate:o,onOpen:j,onEdit:r,onDelete:c,sidebarCardProps:{header:Je,content:Ue},CardComponent:_e,cardActions:m})})]})},Xe=()=>{const{t:s}=b();return e.jsxs(Ve,{title:s("hosts"),children:[e.jsx(We,{}),e.jsx(v.Suspense,{fallback:e.jsx(Fe,{}),children:e.jsx(Be,{})})]})},gs=Re("/_dashboard/hosts")({component:()=>e.jsx(qe,{children:e.jsx(Xe,{})})});export{Xe as HostsPage,gs as Route};
