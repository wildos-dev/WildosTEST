import{r as x,j as e}from"./react-core-Bcdk_OeX.js";import{u as f,n as b,P as N,o as v,j as p,p as S,I as h,q as O,D as F,r as z,s as I,t as T,v as U,w as k,x as E,y as P,z as _,O as D,A as m,E as K,F as w,G as A,H as L,J as B,K as M,L as V,M as $,N as H,R,T as Q,U as G,V as X,X as q,Y as J,Z as Y}from"./index-D9xJNTt9.js";import"./layout-Y81SaLgb.js";import{d as j,aK as o}from"./react-ecosystem-DA9e0y3F.js";import"./dnd-kit-BufO2FBr.js";import{u as Z,L as W,h as ee,O as se}from"./router-BzWBhOx2.js";import{P as te}from"./index-d4rf_bwY.js";import{E as ae}from"./entity-table-B7On41yN.js";import{N as re}from"./index-Cvb6BIEQ.js";import"./monaco-D6sUsa5W.js";import"./styling-utils--BulIq_u.js";import"./network-3TAtD9nM.js";import"./forms-D7oth6Cp.js";import"./search-CgVhiaN-.js";import"./query-BGTG4bZD.js";import"./state-BNTuQEE6.js";import"./date-utils-hmeNWewA.js";import"./table-DQ5QIWK1.js";import"./recharts-CPh6Hnhc.js";function ne({title:a,column:s,options:t}){const[i,n]=x.useState(!1),d=f("md"),[r,c]=x.useState(null),{filters:u,table:{setPageIndex:l}}=b();function y(){u.setColumnsFilter({...u.columnsFilter,[s.id]:void 0}),c(null),l(1)}return d?e.jsxs(N,{open:i,onOpenChange:n,children:[e.jsx(v,{asChild:!0,children:e.jsxs(p,{variant:"ghost",size:"sm",className:"data-[state=open]:bg-accent justify-start",children:[r||a,e.jsx(p,{variant:"ghost",onMouseDown:y,size:"sm",className:S("p-2 ml-1",{"hover:text-destructive/90":!!r,"hover:text-primary/90":!r}),children:r?e.jsx(h,{name:"FilterX",className:"size-4"}):e.jsx(h,{name:"Filter",className:"size-4"})})]})}),e.jsx(O,{className:"w-[200px] p-0",align:"start",children:e.jsx(g,{setOpen:n,columnName:s.id,setSelectedOption:C=>{c(C),l(1)},options:t})})]}):e.jsxs(F,{open:i,onOpenChange:n,children:[e.jsx(z,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",className:"data-[state=open]:bg-accent w-fit justify-start",children:r||a})}),e.jsx(I,{children:e.jsx("div",{className:"mt-4 border-t",children:e.jsx(g,{setOpen:n,columnName:s.id,setSelectedOption:c,options:t})})})]})}function g({setOpen:a,setSelectedOption:s,options:t,columnName:i}){const{filters:n}=b(),{t:d}=j();return e.jsxs(T,{children:[e.jsx(U,{className:"border-0 focus:ring-0",placeholder:d("placeholders.filter-options")}),e.jsxs(k,{children:[e.jsx(E,{children:d("table.no-result-found")}),e.jsx(P,{children:t.map(r=>e.jsx(_,{value:r,onSelect:c=>{s(c),a(!1),n.setColumnsFilter({...n.columnsFilter,[i]:c})},children:r},r))})]})]})}const ie=a=>[{accessorKey:"username",header:({column:s})=>e.jsx(m,{title:o.t("username"),column:s}),cell:({row:s})=>{const t=s.original;return t?e.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[e.jsx(D,{user:t})," ",t.username||o.t("unknown")]}):null}},{accessorKey:"activated",enableSorting:!1,header:({column:s})=>e.jsx(m,{title:o.t("activated"),column:s}),cell:({row:s})=>{const t=s.original;return t?e.jsx(K,{user:t}):null}},{accessorKey:"owner_username",enableSorting:!1,sudoVisibleOnly:!0,header:({column:s})=>e.jsx(le,{column:s}),meta:{className:"hidden lg:table-cell"}},{accessorKey:"used_traffic",header:({column:s})=>e.jsx(m,{title:o.t("page.users.used_traffic"),column:s,className:"hidden sm:table-cell"}),cell:({row:s})=>{const t=s.original;return t?e.jsx("div",{className:"hidden sm:table-cell",children:e.jsx(w,{user:t})}):null},meta:{className:"hidden sm:table-cell"}},{accessorKey:"expire_strategy",header:({column:s})=>e.jsx(m,{title:o.t("page.users.expire_method"),column:s,className:"hidden md:table-cell"}),cell:({row:s})=>{const t=s.original;return t?e.jsx("div",{className:"hidden md:table-cell",children:e.jsx(A,{user:t})}):null},enableSorting:!1,meta:{className:"hidden md:table-cell"}},{accessorKey:"expire_date",header:({column:s})=>e.jsx(m,{title:o.t("page.users.expire_date"),column:s,className:"hidden md:table-cell"}),cell:({row:s})=>{const t=s.original;return t?e.jsx("div",{className:"hidden md:table-cell",children:e.jsx(L,{user:t})}):null},meta:{className:"hidden md:table-cell"}},{id:"actions",header:()=>e.jsx("span",{className:"sr-only",children:o.t("actions")}),cell:({row:s})=>{const t=s.original;if(!t)return null;const i=!f("md");return e.jsx(re,{row:s,actions:a,children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(B,{text:V(t.subscription_url||""),successMessage:o.t("page.users.settings.subscription_link.copied"),copyIcon:n=>e.jsx(h,{name:"Link",...n}),className:M({variant:"secondary",size:i?"touch-sm":"sm",className:i?"size-10":"size-8"}),tooltipMsg:o.t("page.users.settings.subscription_link.copy"),"data-testid":`button-copy-link-${t.username}`}),e.jsx($,{...a,row:s})]})})}}];function le({column:a}){const{data:s}=H({page:1,size:100,filters:{}});return e.jsx(ne,{title:o.t("owner"),column:a,options:s?.entities?.map(t=>t?.username).filter(Boolean)||[]})}const oe=()=>{const a=Z({from:"/users"}),{isSudo:s}=R(),t=l=>{a({to:"/users/$userId",params:{userId:l.username}})},i=l=>{a({to:"/users/$userId/edit",params:{userId:l.username}})},n=l=>{a({to:"/users/$userId/delete",params:{userId:l.username}})},d=ie({onEdit:i,onDelete:n,onOpen:t}),r=d.filter(l=>!l.sudoVisibleOnly),c=s()?d:r,u={onEdit:i,onDelete:n,onOpen:t};return e.jsx(ae,{fetchEntity:X,columns:c,primaryFilter:"username",entityKey:G,onCreate:()=>a({to:"/users/create"}),onOpen:t,CardComponent:Q,cardActions:u})},ce=()=>{const{t:a}=j(),{data:s}=q({page:1,size:10});return s&&s.pageCount===0&&e.jsx(J,{title:a("page.users.services-alert.title"),desc:e.jsxs(e.Fragment,{children:[a("page.users.services-alert.desc"),e.jsx(W,{className:"m-1 font-semibold text-secondary-foreground",to:"/services",children:a("page.nodes.certificate-alert.click")})]})})},de=()=>{const{t:a}=j();return e.jsxs(te,{title:a("users"),footer:e.jsx(ce,{}),children:[e.jsx(oe,{}),e.jsx(x.Suspense,{fallback:e.jsx(Y,{}),children:e.jsx(se,{})})]})},Ue=ee("/_dashboard/users")({component:()=>e.jsx(de,{})});export{Ue as Route,de as UsersPage};
