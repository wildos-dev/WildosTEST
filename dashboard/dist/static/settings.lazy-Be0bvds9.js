import{j as s,r as N}from"./react-core-Bcdk_OeX.js";import{$ as O,a0 as V,a1 as $,a2 as u,a3 as p,a4 as x,a5 as g,a6 as q,a7 as Q,a8 as H,a9 as U,aa as o,ab as W,j as k,l as y,ac as C,P as B,o as G,I as K,q as J,ad as X,ae as Y,af as Z,ag as ss,ah as es,ai as D,k as ts,aj as as,ak as P,h as ns,al as rs,a as is,S as ls}from"./index-D9xJNTt9.js";import"./layout-Y81SaLgb.js";import{aS as os,aT as cs,d as c,aA as L,aK as A}from"./react-ecosystem-DA9e0y3F.js";import{D as ds,d as ms,a as us,b as I,c as ps,e as xs,r as hs,f as js,S as gs,v as fs,g as bs,K as ys,T as vs,M as Ss}from"./dnd-kit-BufO2FBr.js";import{h as Ns}from"./router-BzWBhOx2.js";import{P as ks}from"./index-d4rf_bwY.js";import{o as E,i as Cs,s as v,c as T,a as Fs,f as _s,h as f,u as ws,t as Ds,l as Is}from"./forms-D7oth6Cp.js";import{u as Ts,s as M}from"./subscription-settings.query-Dzq2Qyac.js";import{a as As}from"./query-BGTG4bZD.js";import{S as Rs}from"./index-BqxW2es5.js";import"./monaco-D6sUsa5W.js";import"./styling-utils--BulIq_u.js";import"./network-3TAtD9nM.js";import"./search-CgVhiaN-.js";import"./state-BNTuQEE6.js";import"./date-utils-hmeNWewA.js";import"./table-DQ5QIWK1.js";import"./recharts-CPh6Hnhc.js";const zs={sideEffects:ms({styles:{active:{opacity:"0.4"}}})};function Ps({activeId:e,dropAnimation:t=zs,children:a,...l}){return s.jsx(ds,{dropAnimation:t,...l,children:e?s.jsx(O,{value:e,asChild:!0,children:a}):null})}function Es({value:e,onValueChange:t,collisionDetection:a=xs,modifiers:l=[hs,js],strategy:n=fs,onMove:d,children:i,overlay:b,...h}){const[F,j]=N.useState(null),_=us(I(Ss),I(vs),I(ys));return s.jsxs(ps,{modifiers:l,sensors:_,onDragStart:({active:r})=>j(r.id),onDragEnd:({active:r,over:m})=>{if(m&&r.id!==m?.id){const R=e.findIndex(w=>w.id===r.id),z=e.findIndex(w=>w.id===m.id);d?d({activeIndex:R,overIndex:z}):t?.(bs(e,R,z))}j(null)},onDragCancel:()=>j(null),collisionDetection:a,...h,children:[s.jsx(gs,{items:e,strategy:n,children:i}),b?s.jsx(Ps,{activeId:F,children:b}):null]})}const Os=E({rules:Fs(E({pattern:v(),result:_s(["xray","sing-box","clash","clash-meta","block","links","base64-links","template"])})),shuffle_configs:T(),placeholder_if_disabled:T(),placeholder_remark:v(),template_on_acceptance:T().default(!1),profile_title:v().default(""),support_link:v().default(""),update_interval:Cs.number().int().default(0)}),Ks=({index:e,field:t,onRemove:a})=>{const l=f(),[n,d]=V(!1);return s.jsxs(s.Fragment,{children:[s.jsx($,{open:n,onOpenChange:d,action:()=>a(e)}),s.jsx(O,{value:t.id,asChild:!0,children:s.jsxs("div",{className:"grid grid-cols-[2fr,1.3fr,0.25fr,0.25fr] items-center justify-start gap-2 my-2",children:[s.jsx(u,{control:l.control,name:`rules.${e}.pattern`,render:({field:i})=>s.jsx(p,{children:s.jsx(x,{children:s.jsx("div",{children:s.jsx(g,{className:"h-8",...i})})})})}),s.jsx(u,{control:l.control,name:`rules.${e}.result`,render:({field:i})=>s.jsx(p,{children:s.jsxs(q,{onValueChange:i.onChange,defaultValue:i.value,children:[s.jsx(x,{children:s.jsx("div",{children:s.jsx(Q,{className:"h-8 p-2",children:s.jsx(H,{})})})}),s.jsxs(U,{children:[s.jsx(o,{value:"xray",children:"xray"}),s.jsx(o,{value:"sing-box",children:"sing-box"}),s.jsx(o,{value:"clash",children:"clash"}),s.jsx(o,{value:"clash-meta",children:"clash-meta"}),s.jsx(o,{value:"block",children:"block"}),s.jsx(o,{value:"template",children:"template"}),s.jsx(o,{value:"base64-links",children:"base64-links"}),s.jsx(o,{value:"links",children:"links"})]})]})})}),s.jsx(W,{variant:"outline",size:"icon",className:"size-8 shrink-0",children:s.jsx(os,{className:"size-4","aria-hidden":"true"})}),s.jsxs(k,{type:"button",variant:"outline",size:"icon",className:"size-8 shrink-0",onClick:()=>d(!0),children:[s.jsx(cs,{className:"size-4 text-destructive","aria-hidden":"true"}),s.jsx("span",{className:"sr-only",children:"Remove"})]})]})},t.id)]})},S=()=>s.jsxs("div",{className:"grid grid-cols-[2fr,1.3fr,0.25fr,0.25fr] items-center justify-start gap-2 my-0 ",children:[s.jsx(y,{className:"h-8 w-full rounded-sm"}),s.jsx(y,{className:"h-8 w-full rounded-sm"}),s.jsx(y,{className:"size-8 shrink-0 rounded-sm"}),s.jsx(y,{className:"size-8 shrink-0 rounded-sm"})]}),Ls=()=>{const{t:e}=c(),t=f();return s.jsx(u,{control:t.control,name:"profile_title",render:({field:a})=>s.jsxs(p,{children:[s.jsx(C,{children:e("page.settings.subscription-settings.profile-title")}),s.jsx(x,{children:s.jsx(g,{className:"h-8",...a})})]})})},Ms=()=>{const{t:e}=c(),t=f();return s.jsx(u,{control:t.control,name:"support_link",render:({field:a})=>s.jsxs(p,{children:[s.jsx(C,{children:e("page.settings.subscription-settings.support-link")}),s.jsx(x,{children:s.jsx(g,{className:"h-8",...a})})]})})},Vs=()=>{const{t:e}=c(),t=f();return s.jsx(u,{control:t.control,name:"update_interval",render:({field:a})=>s.jsxs(p,{children:[s.jsx(C,{children:e("page.settings.subscription-settings.update-interval")}),s.jsx(x,{children:s.jsx(g,{className:"h-8",type:"number",...a,...t.register("update_interval",{valueAsNumber:!0})})})]})})},$s=()=>{const{t:e}=c(),t=f();return s.jsx(u,{control:t.control,name:"placeholder_remark",render:({field:a})=>s.jsxs(p,{children:[s.jsxs(C,{className:"flex flex-row items-center gap-2",children:[e("page.settings.subscription-settings.placeholder-remark"),s.jsxs(B,{children:[s.jsx(G,{children:s.jsx(K,{name:"Info",className:"size-5"})}),s.jsx(J,{className:"w-80",children:s.jsx(X,{})})]})]}),s.jsx(x,{children:s.jsx(g,{className:"h-8",...a})})]})})},qs=()=>{const{t:e}=c();return s.jsxs(Y,{children:[s.jsx(K,{name:"Info",className:"mr-2"}),s.jsx(Z,{className:"font-semibold text-primary",children:e("page.settings.subscription-settings.alert.title")}),s.jsx(ss,{children:e("page.settings.subscription-settings.alert.desc")})]})};function Qs(){const{t:e}=c(),{data:t,isFetching:a}=Ts(),l=Bs(),n=ws({resolver:Ds(Os),defaultValues:t}),d=N.useCallback(()=>{n.reset(t)},[n,t]),i=N.useCallback(()=>{n.reset(t,{keepDirtyValues:!0})},[n,t]);N.useEffect(()=>{t&&i()},[t,i]);const b=r=>{l.mutate(r)},{fields:h,append:F,move:j,remove:_}=Is({control:n.control,name:"rules"});return s.jsx(es,{...n,children:s.jsxs("form",{onSubmit:n.handleSubmit(b),className:"flex w-full max-w-4xl flex-col space-y-4 sm:space-y-6",children:[s.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[s.jsx(Ls,{}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6",children:[s.jsx(Vs,{}),s.jsx(Ms,{})]}),s.jsx(D,{name:"template_on_acceptance",label:e("page.settings.subscription-settings.template-on-acceptance")}),s.jsx($s,{}),s.jsx(D,{name:"placeholder_if_disabled",label:e("page.settings.subscription-settings.placeholder-if-disabled")}),s.jsx(D,{name:"shuffle_configs",label:e("page.settings.subscription-settings.shuffle-configs")})]}),s.jsx(ts,{className:"my-4 sm:my-6"}),s.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[s.jsx("h4",{className:"text-lg sm:text-xl font-semibold",children:e("page.settings.subscription-settings.subscription-title")}),s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:e("page.settings.subscription-settings.subscription-desc")})]}),s.jsx(as,{isFetching:a,Skeleton:s.jsxs(s.Fragment,{children:[s.jsx(S,{}),s.jsx(S,{}),s.jsx(S,{}),s.jsx(S,{})]}),isNotFound:h.length===0,NotFound:s.jsx(qs,{}),Component:s.jsx("div",{className:"space-y-1",children:s.jsxs(Es,{value:h,onMove:({activeIndex:r,overIndex:m})=>j(r,m),children:[s.jsxs("div",{className:"grid grid-cols-[2fr,1.3fr,0.25fr,0.25fr] items-center justify-start gap-2 my-2",children:[s.jsx(P,{className:"font-semibold",children:e("pattern")}),s.jsx(P,{className:"font-semibold",children:e("result")})]}),s.jsx(ns,{className:"flex flex-col w-full max-h-[400px] gap-2",type:"always",children:h.map((r,m)=>s.jsx(Ks,{field:r,index:m,onRemove:_}))})]})})}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 sm:justify-end pt-4 sm:pt-6 border-t",children:[s.jsx(k,{type:"button",variant:"destructive",className:"w-full h-12 sm:h-auto sm:w-auto text-sm sm:text-base",onMouseDown:d,children:e("page.settings.subscription-settings.reset-local-changes")}),s.jsx(k,{type:"button",variant:"outline",className:"w-full h-12 sm:h-auto sm:w-auto text-sm sm:text-base",onClick:()=>F({pattern:"",result:"block"}),children:e("page.settings.subscription-settings.add-rule")}),s.jsx(k,{type:"submit",className:"w-full h-12 sm:h-auto sm:w-auto text-sm sm:text-base font-semibold",children:e("submit")})]})]})})}async function Hs(e){return is("/system/settings/subscription",{method:"put",body:e}).then(t=>t)}const Us=()=>{L.error(A.t("events.update.error"))},Ws=()=>{L.success(A.t("events.update.success.title",{name:"Subscription Settings"}),{description:A.t("events.update.success.desc")}),rs.invalidateQueries({queryKey:M})},Bs=()=>As({mutationKey:M,mutationFn:Hs,onError:Us,onSuccess:Ws}),Gs=()=>{const{t:e}=c();return s.jsx(ls,{title:e("page.settings.subscription-settings.title"),description:e("page.settings.subscription-settings.description"),content:s.jsx(Qs,{}),className:"p-4 sm:p-6",titleClassName:"text-lg sm:text-xl",descriptionClassName:"text-sm sm:text-base"})},Js=()=>{const{t:e}=c();return s.jsx(ks,{title:e("settings"),className:"p-4 sm:p-6",children:s.jsx("div",{className:"space-y-4 sm:space-y-6 max-w-4xl",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[s.jsx("div",{className:"space-y-4 sm:space-y-6",children:s.jsx(Gs,{})}),s.jsx("div",{className:"space-y-4 sm:space-y-6"})]})})})},je=Ns("/_dashboard/settings")({component:()=>s.jsxs(Rs,{children:[" ",s.jsx(Js,{})," "]})});export{je as Route,Js as Settings};
